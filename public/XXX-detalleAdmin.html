<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Carga de Indicadores</title>
    <script src="script.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="css/estilos.css" rel="stylesheet">
</head>

<body>
    <h1>Cargar Indicador de Gestión</h1>
    <form id="formIndicador">
        <label>Nombre del Indicador:<br><input type="text" name="nombre" required></label><br>
        <label>Descripción:<br><input type="text" name="descripcion" required></label><br>
        <label>Unidad de Medida:<br><input type="text" name="unidad" required></label><br>
        <label>Tipo de Indicador:<br><input type="text" name="tipo" required></label><br>
        <label>Frecuencia de Medición:<br><input type="text" name="frecuencia" required></label><br>
        <label>Área Responsable:<br><input type="text" name="area" required></label><br>
        <label>Meta:<br><input type="text" name="meta" required></label><br>
        <div class="botones-acceso">
            <a href="usuarios.html" class="btn">Usuarios</a>
            <a href="administracion.html" class="btn">Administración</a>
        </div>
    </form>
    <div id="mensaje"></div>

    <script>
        document.getElementById('formCambiarPassword').addEventListener('submit', async e => {
            e.preventDefault();

            const p1 = password1.value.trim();
            const p2 = password2.value.trim();

            if (p1.length < 8) {
                alert('La contraseña debe tener al menos 8 caracteres');
                return;
            }

            if (p1 !== p2) {
                alert('Las contraseñas no coinciden');
                return;
            }

            const token = localStorage.getItem('token');

            const resp = await fetch('/api/auth/cambiar-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: 'Bearer ' + token
                },
                body: JSON.stringify({ password: p1 })
            });

            const data = await resp.json();

            if (!resp.ok) {
                alert(data.error || 'Error al cambiar contraseña');
                return;
            }

            alert('Contraseña actualizada correctamente');
            localStorage.clear();
            window.location.href = '/login.html';
        });


    </script>
</body>

</html>