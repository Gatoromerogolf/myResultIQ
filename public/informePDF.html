<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plantilla Informe - myResultIQ</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@300;400;500&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --azul: #1F78FF;
      --gris: #333333;
      --gris-claro: #F2F2F2;
      --espacio: 16px;
      --page-width-mm: 210mm;
      /* A4 */
    }

    /* Reset b√°sico */
    * {
      box-sizing: border-box
    }

    body {
      font-family: 'Roboto', system-ui, sans-serif;
      color: var(--gris);
      margin: 0;
      background: #efefef;
    }

    /* Contenedor que simula el documento */
    .doc-wrap {
      max-width: 900px;
      margin: 24px auto;
      padding: 24px
    }

    .toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px
    }

    button {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer
    }

    /* Estilos de p√°gina (cada .page ser√° una hoja A4 cuando se exporte a PDF) */
    .page {
      width: 210mm;
      height: 297mm;
      /* Fijar exactamente una A4 */
      background: white;
      margin: 0;
      position: relative;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      /* evita cortes extra */
    }

    /* MARCO INTERNO */
    .marco {
      border: 2px solid #007BFF;
      border-radius: 5mm;
      padding: 12mm;
      margin: 20mm 12mm 20mm 12mm;
      /* margen interno superior / inferior */
      height: calc(297mm - 40mm);
      /* altura real √∫til */
      box-sizing: border-box;
    }

    /* Contenido */
    .content {
      overflow: hidden;
      /* evita ‚Äúspill‚Äù */
    }

    .marco,
    .content,
    table,
    h2,
    p {
      page-break-inside: avoid;
    }

    /* Header / Footer */
    .header {
      position: absolute;
      top: 5mm;
      left: 10mm;
      right: 10mm;
      text-align: center;
    }

    .footer {
      position: absolute;
      bottom: 5mm;
      left: 10mm;
      right: 10mm;
      text-align: center;
    }

    /* === PORTADA PREMIUM === */
    .cover-page {
      padding: 0 !important;
      position: relative;
      overflow: hidden;
      background-size: cover !important;
      background-position: center !important;
      background-repeat: no-repeat !important;
      color: white;
      font-family: 'Montserrat', sans-serif;
    }

    /* Overlay degradado premium */
    .cover-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg,
          rgba(0, 0, 0, 0.65) 0%,
          rgba(0, 0, 0, 0.30) 40%,
          rgba(0, 0, 0, 0.55) 100%);
      z-index: 1;
    }

    /* Contenedor central */
    .cover-content {
      position: absolute;
      inset: 0;
      z-index: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40mm 25mm 30mm 25mm;
      text-align: center;
    }

    /* Logo */
    .cover-logocomun {
      width: 25mm;
      opacity: 0.95;
      margin-bottom: 20mm;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .cover-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30mm;
      /* si quer√©s ajustarlo */
      opacity: 0.95;
    }

    /* T√≠tulos */
    .cover-title {
      font-size: 34pt;
      font-weight: 700;
      margin-bottom: 10mm;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.55);
    }

    .cover-subtitle {
      font-size: 20pt;
      font-weight: 500;
      margin-bottom: 3mm;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.45);
    }

    /* RESUMEN EJECUTIVO */
    .cover-resumen {
      margin-top: 18mm;
      font-size: 14pt;
      font-weight: 300;
      line-height: 1.55;
      text-align: justify;
      padding: 0 5mm;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    }

    /* Pie */
    .cover-bottom {
      position: absolute;
      bottom: 12mm;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 12pt;
      opacity: 0.85;
      z-index: 3;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.55);
    }



    .cover2-page {
      padding: 0 !important;
      position: relative;
      overflow: hidden;
      background-size: cover !important;
      background-position: center !important;
      background-repeat: no-repeat !important;
      color: rgb(65, 138, 247);
      font-family: 'Montserrat', sans-serif;
    }

    /* Overlay degradado premium */
    .cover2-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg,
          rgba(0, 0, 0, 0.65) 0%,
          rgba(0, 0, 0, 0.30) 40%,
          rgba(0, 0, 0, 0.55) 100%);
      z-index: 1;
    }

    /* Contenedor central */
    .cover2-content {
      position: absolute;
      inset: 0;
      z-index: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40mm 25mm 30mm 25mm;
      text-align: center;
    }

    /* Logo */
    .cover2-logocomun {
      width: 25mm;
      opacity: 0.95;
      margin-bottom: 20mm;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .cover2-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30mm;
      /* si quer√©s ajustarlo */
      opacity: 0.95;
    }

    /* T√≠tulos */
    .cover2-empresa {
      font-size: 35pt;
      font-weight: 500;
      color: #333333;
      position: absolute;
      top: 80mm;
      /* distancia desde arriba */
      left: 0;
      right: 0;
      text-align: center;
    }

    /* T√≠tulos */
    .cover2-infoeje {
      font-size: 24pt;
      font-weight: 500;
      position: absolute;
      top: 110mm;
      /* distancia desde arriba */
      left: 0;
      right: 0;
      text-align: center;
    }

    .cover2-indiGes {
      font-size: 40pt;
      font-weight: 600;
      color: #333333;
      position: absolute;
      top: 130mm;
      left: 0;
      right: 0;
      text-align: center;
    }

    .cover2-seguimiento {
      font-size: 20pt;
      font-weight: 500;
      position: absolute;
      top: 160mm;
      width: 80%;
      /* left: 20px;
      right: 20px; */
      text-align: center;
    }

    .cover2-intro {
      font-size: 14pt;
      font-weight: 400;
      /* position: absolute;
      top: 90mm;
      left: 40mm;
      right: 40mm; */
      text-align: justify;
    }

    .cover2-subtitle2 {
      font-size: 14pt;
      font-weight: 400;
      position: absolute;
      top: 90mm;
      left: 40mm;
      right: 40mm;
      text-align: justify;
    }

    .cover2-piemyResult {
      font-size: 12pt;
      font-weight: 400;
      position: absolute;
      top: 220mm;
      left: 30mm;
      right: 30mm;
      text-align: justify;
    }

    /* RESUMEN EJECUTIVO */
    .cover2-resumen {
      margin-top: 18mm;
      font-size: 14pt;
      font-weight: 300;
      line-height: 1.55;
      text-align: justify;
      padding: 0 5mm;
      position: absolute;
      top: 170mm;
      /* text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); */
    }

    /* Pie */
    .cover2-bottom {
      position: absolute;
      bottom: 12mm;
      left: 40px;
      width: 100%;
      text-align: center;
      font-size: 12pt;
      opacity: 0.85;
      z-index: 3;
      /* text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.55); */
    }

    .cover2-piemyResult {
      font-size: 12pt;
      margin-top: 10mm;
      text-align: center;
    }

    .logo-image {
      width: 20mm;
      margin-top: 5mm;
      opacity: 0.9;
    }

    h2.section-title {
      font-family: 'Montserrat';
      font-size: 18px;
      margin: 6px 0 12px 0;
      color: var(--azul)
    }

    /* Contenedor de las m√©tricas: 4 columnas fijas */
    .metrics {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      width: 100%;
    }

    /* Tarjetas */
    .metric {
      background: #fff;
      border: 1px solid #eee;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
      display: flex;
      flex-direction: column;
      /* apila label arriba y valor abajo */
      align-items: center;
      /* centra horizontalmente */
    }

    .metric .label {
      font-size: 12px;
      color: #666;
    }

    .metric .value {
      font-size: 22px;
      font-weight: 600;
      margin-top: 6px;
    }

    /* üì± RESPONSIVE: en pantallas peque√±as pasa a 2x2 */
    @media (max-width: 768px) {
      .metrics {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* üì± Extra chico: 1 por l√≠nea */
    @media (max-width: 450px) {
      .metrics {
        grid-template-columns: 1fr;
      }
    }

    /* Tabla simple */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #eee;
      text-align: left;
      font-size: 13px
    }

    th {
      background: var(--gris-claro);
      font-weight: 600
    }

    /* Page break helper */
    .page-break {
      page-break-after: always;
    }

    /* TOC */
    .toc-list {
      list-style: none;
      padding: 0;
      margin: 0
    }

    .toc-list li {
      padding: 6px 0;
      border-bottom: 1px dashed #eee
    }

    .separator {
      width: 65%;
      height: 3px;
      background: #444;
      border-radius: 3px;
      margin: 0 auto 35px auto;
      position: absolute;
      top: 100mm;
    }

    /* Responsive preview scaling */
    @media (max-width:980px) {
      .doc-wrap {
        padding: 10px
      }

      .page {
        width: 100%;
        min-height: 1200px
      }
    }
  </style>
</head>

<body>

  <div class="doc-wrap">
    <div class="toolbar">
      <button id="btn-build">Generar documento</button>
      <button id="btn-pdf">Exportar a PDF</button>
      <button id="btn-preview">Vista previa en nueva ventana</button>
      <label style="margin-left:12px;font-size:13px;color:#555">Plantilla base</label>
    </div>

    <!-- Contenedor donde el script crear√° las p√°ginas -->
    <div id="documento"></div>
  </div>

  <!-- Dependencia para exportar a PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <script>
    // Datos de ejemplo (luego los reemplaz√°s por tus datos reales)
    empresa = "SEDRONAR";
    const ejemplo = {
      titulo: 'Informe de Indicadores',
      subtitulo: 'Gesti√≥n, seguimiento y an√°lisis de m√©tricas organizacionales',
      fecha: new Date().toLocaleDateString('es-AR', { year: 'numeric', month: 'long', day: 'numeric' }),
      autor: '√Årea de Gesti√≥n de Indicadores',
      resumen: {
        cumplimientoGlobal: '82%',
        promedioHistorico: '78.4',
        deltaMes: '+3.2%'
      },

      sectores: [
        {
          id: 1, nombre: 'Comercial', indicadores: [
            { id: 11, nombre: 'Ventas mensuales', meta: '100k', valor: '92k', estado: 'amarillo' },
            { id: 12, nombre: 'Tasa de conversi√≥n', meta: '2.5%', valor: '3.1%', estado: 'verde' }
          ]
        },
        {
          id: 2, nombre: 'Operaciones', indicadores: [
            { id: 21, nombre: 'Tiempo de respuesta', meta: '<24h', valor: '18h', estado: 'verde' },
            { id: 22, nombre: 'Incidentes cr√≠ticos', meta: '0', valor: '1', estado: 'rojo' }
          ]
        }
      ]
    };

    // --- Construcci√≥n del documento (DOM) ---
    const documento = document.getElementById('documento');

    function clearDocument() { documento.innerHTML = ''; }

    function createPage() {
      const page = document.createElement('section');
      page.className = 'page';

      // Header (fuera del marco)
      const header = document.createElement('div');
      header.className = 'header';
      header.innerHTML = `<div>${ejemplo.titulo}</div><div>${ejemplo.fecha}</div>`;
      page.appendChild(header);

      // Marco interno
      const marco = document.createElement('div');
      marco.className = 'marco';
      page.appendChild(marco);

      // Contenido dentro del marco
      const content = document.createElement('div');
      content.className = 'content';
      marco.appendChild(content);

      // Footer (fuera del marco)
      const footer = document.createElement('div');
      footer.className = 'footer';
      footer.innerHTML = `
    <div>Generado por: ${ejemplo.autor}</div>
    <div class="page-number">P√°gina</div>
  `;
      page.appendChild(footer);

      return { page, content };
    }

    function buildCover() {
      const page = document.createElement('section');
      page.className = 'page cover-page';

      // === Fondo de barras diagonales modernas ===
      page.style.background = `
      repeating-linear-gradient(
        -45deg,
        #0a2850 0,
        #0a2850 12mm,
        #123d80 12mm,
        #123d80 24mm
      )
  `;
      page.style.backgroundSize = "cover";

      // Overlay premium
      const overlay = document.createElement('div');
      overlay.className = 'cover-overlay';
      page.appendChild(overlay);

      // Contenido central
      const content = document.createElement('div');
      content.className = 'cover-content';

      // Logo
      const logo = document.createElement('img');
      logo.className = 'cover-logo';
      logo.src = "../dist/images/leon.png";
      // content.appendChild(logo);
      page.appendChild(logo);  // ‚¨ÖÔ∏è importante: no va dentro de cover-content

      // T√≠tulo principal
      const title = document.createElement('div');
      title.className = 'cover-title';
      title.textContent = ejemplo.titulo;
      content.appendChild(title);

      // Subt√≠tulo
      const subtitle = document.createElement('div');
      subtitle.className = 'cover-subtitle';
      subtitle.textContent = ejemplo.subtitulo;
      content.appendChild(subtitle);

      // Resumen ejecutivo
      const resumen = document.createElement('div');
      resumen.className = 'cover-resumen';
      resumen.textContent =
        "Este informe resume los principales indicadores estrat√©gicos, " +
        "identifica variaciones cr√≠ticas y presenta una visi√≥n anal√≠tica " +
        "general del desempe√±o institucional durante el per√≠odo evaluado. <br>" +
        "<br><br>" +
        "Los datos presentados han sido procesados con la plataforma <strong>myResultIQ</strong>, asegurando precisi√≥n y trazabilidad en cada etapa del an√°lisis.";
      content.appendChild(resumen);

      page.appendChild(content);

      // Pie inferior
      const bottom = document.createElement('div');
      bottom.className = 'cover-bottom';
      bottom.textContent = `Generado el ${ejemplo.fecha}`;
      page.appendChild(bottom);

      documento.appendChild(page);
    }

    function buildCover2() {
      const page = document.createElement('section');
      page.className = 'page cover2-page';

      // === Fondo completo ===
      // page.style.backgroundImage = 'url("../dist/images/Fondomy.png")';
      page.style.backgroundImage = 'url("../dist/images/PortadaAzulBlanca.png")';

      // Contenedor central
      const content = document.createElement('div');
      content.className = 'cover2-content';

      // Empresa
      const subtitle = document.createElement('div');
      subtitle.className = 'cover2-empresa';
      subtitle.textContent = "SEDRONAR";
      content.appendChild(subtitle);

      //Informe Ejecutivo
      const infoEje = document.createElement('div');
      infoEje.className = 'cover2-infoeje';
      infoEje.textContent = "Informe Ejecutivo";
      content.appendChild(infoEje);

      //Indicadores de Gesti√≥n
      const indiGes = document.createElement('div');
      indiGes.className = 'cover2-indiGes';
      indiGes.textContent = "Indicadores de Gesti√≥n";
      content.appendChild(indiGes);


      // T√≠tulo
      const title = document.createElement('div');
      title.className = 'cover2-seguimiento';
      title.textContent = "Seguimiento y an√°lisis de m√©tricas organizacionales.";
      content.appendChild(title);


      // Pie inferior
      const bottom = document.createElement('div');
      bottom.className = 'cover2-bottom';
      bottom.textContent = `${ejemplo.fecha}`;
      content.appendChild(bottom);

      page.appendChild(content);

      documento.appendChild(page);
    }

    function buildIntrooverview() {
      const { page, content } = createPage();
      const h = document.createElement('h1');
      h.className = 'section-title';
      h.textContent = 'Marco Introductorio y Visi√≥n General';
      content.appendChild(h);

      const p = document.createElement('p');
      p.className = 'cover2-intro';
      p.innerHTML = `

          <h4>Introducci√≥n y Visi√≥n General</h4>

          <p>El presente informe tiene por finalidad ofrecer una visi√≥n integral y consolidada del desempe√±o organizacional mediante el an√°lisis de los indicadores clave de gesti√≥n (KPIs). Se presenta una s√≠ntesis estructurada de la informaci√≥n disponible en el dashboard interactivo, con el prop√≥sito de facilitar la toma de decisiones estrat√©gicas basadas en datos cuantitativos y cualitativos correspondientes al per√≠odo evaluado.</p>

          <h4>Destinatarios</h4>
          Este documento est√° dirigido a la Alta Direcci√≥n, gerencias de √°rea y dem√°s actores estrat√©gicos que requieren informaci√≥n precisa, actualizada y confiable para evaluar el desempe√±o institucional, monitorear avances y orientar la planificaci√≥n estrat√©gica..

          <h4>Prop√≥sito y Alcance</h4>

          <p>El informe resume los principales indicadores estrat√©gicos, analiza su evoluci√≥n, identifica desviaciones relevantes y eval√∫a el nivel de cumplimiento respecto de los objetivos establecidos. Adem√°s, integra tendencias, comparaciones interper√≠odos y observaciones contextuales que permiten interpretar el comportamiento de los indicadores.<br><br>El objetivo central es transformar los datos en insights accionables que apoyen la gesti√≥n, la toma de decisiones y el mejoramiento continuo de los procesos institucionales.</p>

          <h4>Calidad y Precisi√≥n de los Datos</h4>
          <p>La validez de los resultados presentados depende directamente de la calidad de los datos utilizados. Por ello, se destaca la importancia de los procesos de verificaci√≥n, consistencia y validaci√≥n aplicados durante cada etapa de recolecci√≥n, procesamiento y consolidaci√≥n.`


      content.appendChild(p);
      documento.appendChild(page);

      // Crear segunda hoja
      const { page: page1, content: content1 } = createPage();

      // Primer bloque
      const p1 = document.createElement('div');
      p1.className = 'cover2-intro';
      p1.innerHTML = `
            <p>Estos mecanismos aseguran la trazabilidad, la transparencia anal√≠tica y la confiabilidad del sistema de medici√≥n, permitiendo construir conclusiones s√≥lidas y comparables en el tiempo.</p>

            <h4> Evoluci√≥n y Mejora Continua</h4>

            <p>El sistema de indicadores que sustenta este informe es din√°mico y evolutivo. La incorporaci√≥n progresiva de nuevos KPIs, as√≠ como la actualizaci√≥n y el refinamiento de los existentes, permitir√° avanzar hacia un monitoreo m√°s detallado y granular del desempe√±o institucional.<br><br>Esta ampliaci√≥n gradual responde al nivel de madurez de los procesos internos y a las necesidades estrat√©gicas detectadas, contribuyendo a una comprensi√≥n cada vez m√°s precisa de los factores que influyen en los resultados organizacionales.</p>

            <h4> Estructura del Informe</h4>

            <p>El documento se organiza en secciones tem√°ticas que agrupan indicadores relacionados. Para cada uno se presentan:<br>
              <ul>
                <li>Valores actuales</li>
                <li>Tendencias hist√≥ricas</li>
                <li>Comparaciones con per√≠odos anteriores</li>
                <li>An√°lisis de brechas respecto de metas establecidas</li>
                <li>Observaciones cualitativas y factores contextuales relevantes</li>
              </ul>

            Esta estructura favorece tanto una lectura integral del desempe√±o global como la consulta segmentada por √°rea o l√≠nea estrat√©gica, seg√∫n las necesidades del usuario.</p>`;

      content1.appendChild(p1);

      const piemyResult = document.createElement('div');
      piemyResult.className = 'cover2-piemyResult';
      piemyResult.innerHTML = `
            Los datos de este informe han sido procesados con la plataforma <strong> myResultIQ</strong>,
            asegurando precisi√≥n y trazabilidad en cada etapa del an√°lisis.
            <br> <br>
              <img src="/dist/images/leon.png" class="logo-image" alt="Logo">
                `;
      page1.appendChild(piemyResult);

      documento.appendChild(page1);
    }

    function buildTOC() {
      const { page, content } = createPage();
      const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = '√çndice';
      content.appendChild(h);

      const ul = document.createElement('ul'); ul.className = 'toc-list';
      // Generamos entradas acordes a las secciones previstas
      const entradas = ['Resumen Ejecutivo', 'Indicadores Globales', 'Indicadores por Sector', 'An√°lisis de Cumplimientos', 'Anexos'];
      entradas.forEach((e, i) => {
        const li = document.createElement('li'); li.textContent = `${i + 1}. ${e}`;
        ul.appendChild(li);
      });

      content.appendChild(ul);

      documento.appendChild(page);
    }


    async function buildResumen() {
      const { page, content } = createPage();
      const h = document.createElement('h2');
      h.className = 'section-title';
      h.textContent = 'Resumen Ejecutivo';
      content.appendChild(h);

      //       const valGlobales = localStorage.getItem('resumenGlobal');
      //       const resumenGlobal = JSON.parse(valGlobales);

      //       const metrics = document.createElement('div');
      //       metrics.className = 'metrics';

      //       const m1 = document.createElement('div');
      //       m1.className = 'metric';
      //       m1.innerHTML = `<div class="label">Promedio Anual</div><div class="value">${resumenGlobal.promAnual}</div>`;

      //       const m2 = document.createElement('div');
      //       m2.className = 'metric';
      //       m2.innerHTML = `<div class="label">Promedio Hist√≥rico</div><div class="value">${resumenGlobal.promHistorico}</div>`;

      //       const m3 = document.createElement('div');
      //       m3.className = 'metric';
      //       let valor = Number(resumenGlobal.variacion) || 0;
      //       let color = "black";
      //       let textoValor = "";
      //       if (valor > 0) { textoValor = `+${valor}`; color = "blue"; }
      //       else if (valor < 0) { textoValor = `${valor}`; color = "red"; }
      //       else { textoValor = "0"; color = "gray"; }

      //       m3.innerHTML = `<div class="label">Œî vs mes anterior</div>
      //                      <div class="value" style="color:${color}; font-weight:600;">
      //                         ${textoValor}
      //                      </div>`;

      //       const m4 = document.createElement('div');
      //       m4.className = 'metric';
      //       let tendencia = (resumenGlobal.tendencia || "");
      //       let colorTendencia = "black";
      //       let icono = "";
      //       if (tendencia === "Creciente%") { colorTendencia = "#007bff"; icono = "üîº"; }
      //       else if (tendencia === "Decreciente%") { colorTendencia = "#d9534f"; icono = "üîΩ"; }
      //       else if (tendencia === "Estable%") { colorTendencia = "#555"; icono = "‚ûñ"; }

      //       const textoTendencia = tendencia.charAt(0).toUpperCase() + tendencia.slice(1);
      //       m4.innerHTML = `<div class="label">Tendencia</div>
      //                     <div class="value" style="color:${colorTendencia}; font-weight:600; display:flex; align-items:center; gap:6px;">
      //                         <span>${icono}</span>
      //                         <span>${textoTendencia}</span>
      //                     </div>`;

      //       metrics.appendChild(m1);
      //       metrics.appendChild(m2);
      //       metrics.appendChild(m3);
      //       metrics.appendChild(m4);
      //       content.appendChild(metrics);

      // // -----------------------
      // // Gr√°fico estilo premium
      // // -----------------------
      // const graf = document.createElement('div');
      // graf.style.marginTop = '20px';
      // graf.style.display = 'flex';
      // graf.style.justifyContent = 'center';

      // // Recuperamos el PNG generado
      // const pngBase64 = localStorage.getItem("ringGlobalPNG");

      // // Valor real del ring (puede venir de resumenGlobal.globalPercent o calculado previamente)
      // const valorRing = resumenGlobal.globalPercent || 0;

      // if (pngBase64) {
      //     graf.innerHTML = `
      //         <div style="
      //             width:180px;
      //             height:180px;
      //             border-radius:50%;
      //             background:#fff;
      //             box-shadow:0 4px 12px rgba(0,0,0,0.1);
      //             display:flex;
      //             flex-direction:column;
      //             align-items:center;
      //             justify-content:center;
      //             position:relative;
      //         ">
      //             <img src="${pngBase64}" style="width:140px; height:140px; border-radius:50%;">
      //             <div style="
      //                 position:absolute;
      //                 font-size:1.5em;
      //                 font-weight:700;
      //                 color:#007bff;
      //             ">

      //             </div>
      //         </div>
      //     `;
      // } else {
      //     graf.innerHTML = `
      //         <div style="height:180px; width:180px; border:1px dashed #ddd; border-radius:50%;
      //                     display:flex; align-items:center; justify-content:center; color:#999;
      //                     box-shadow:0 4px 12px rgba(0,0,0,0.05);">
      //             [Gr√°fico no disponible]
      //         </div>
      //     `;
      // }

      // content.appendChild(graf);

      // -----------------------
      // Texto descriptivo
      // -----------------------
      const p = document.createElement('p');

      const cantSectores = localStorage.getItem('cantSectores');
      const cantActivos = localStorage.getItem('cantIndicadoresActivos');
      const cantDestinos = localStorage.getItem('destinosMedidos');
      const cantMediciones = localStorage.getItem('totalMediciones');
      const cantAlDia = Number(localStorage.getItem('cantOk'));
      const cantDemorados = Number(localStorage.getItem('cantDemorados'));
      const cantPendientes = Number(localStorage.getItem('cantnoInformados'));

      let texto =
        `Se han declarado un total de <strong> ${cantSectores}</strong> destinos, de los cuales <strong> ${cantDestinos}</strong> tienen indicadores asignados.<br><br>` +
        `Cada destino posee un peso que representa su importancia estrat√©gica dentro de la organizaci√≥n, definido en funci√≥n del rol que cumple en la cadena de valor. Estos destinos pueden contar, o no, con indicadores propios asignados.<br><br>` +
        `Se han definido un total de <strong>${cantActivos}</strong> indicadores activos.<br><br>` +
        `Los indicadores est√°n asociados a destinos espec√≠ficos, los cuales a su vez pueden depender jer√°rquicamente de otros. El c√°lculo del cumplimiento global se realiza de manera ascendente: primero se determina el cumplimiento de cada indicador, luego el del destino correspondiente y, finalmente, se consolida el resultado hacia los niveles superiores.<br><br>De esta forma, el cumplimiento global expresa el desempe√±o integral de la organizaci√≥n, ponderado seg√∫n la relevancia de cada destino dentro de la estructura.<br><br>` +
        `Este informe Ejecutivo resume las conclusiones de las mediciones registradas en el per√≠odo comenzado el <strong>99/99/99</strong> y finalizado el <strong>99/99/99</strong>.<br><br>` +
        `Durante este per√≠odo se han realizado y registrado un total de <strong>${cantMediciones}</strong> mediciones.<br><br>`;

      if (cantDemorados === 0 && cantPendientes === 0) {
        texto += `Todos los indicadores fueron medidos con la frecuencia establecida y no hay mediciones pendientes para el per√≠odo definido en este informe.<br><br>`;
      } else {
        const cantAlDia = cantActivos - (cantDemorados + cantPendientes);
        texto += `Solo <strong>${cantAlDia}</strong> indicadores tienen todas sus mediciones informadas en fecha, ` +
          `mientras que <strong>${cantActivos - cantAlDia}</strong> presentan mediciones pendientes o fuera de t√©rmino.<br><br>` +
          `Debido a la ausencia de informaci√≥n completa, los resultados y conclusiones de este informe podr√≠an presentar ` +
          `variaciones respecto de la situaci√≥n real. La falta de mediciones vigentes puede generar desviaciones en los ` +
          `promedios, tendencias y porcentajes de cumplimiento, por lo que las interpretaciones deben realizarse con ` +
          `precauci√≥n.<br><br>`;
      }

      p.innerHTML = texto;
      content.appendChild(p);


      //       const metrics = document.createElement('div');
      //       metrics.className = 'metrics';

      //       const m1 = document.createElement('div');
      //       m1.className = 'metric';
      //       m1.innerHTML = `<div class="label">Promedio Anual</div><div class="value">${resumenGlobal.promAnual}</div>`;

      //       const m2 = document.createElement('div');
      //       m2.className = 'metric';
      //       m2.innerHTML = `<div class="label">Promedio Hist√≥rico</div><div class="value">${resumenGlobal.promHistorico}</div>`;

      //       const m3 = document.createElement('div');
      //       m3.className = 'metric';
      //       let valor = Number(resumenGlobal.variacion) || 0;
      //       let color = "black";
      //       let textoValor = "";
      //       if (valor > 0) { textoValor = `+${valor}`; color = "blue"; }
      //       else if (valor < 0) { textoValor = `${valor}`; color = "red"; }
      //       else { textoValor = "0"; color = "gray"; }

      //       m3.innerHTML = `<div class="label">Œî vs mes anterior</div>
      //                      <div class="value" style="color:${color}; font-weight:600;">
      //                         ${textoValor}
      //                      </div>`;

      //       const m4 = document.createElement('div');
      //       m4.className = 'metric';
      //       let tendencia = (resumenGlobal.tendencia || "");
      //       let colorTendencia = "black";
      //       let icono = "";
      //       if (tendencia === "Creciente%") { colorTendencia = "#007bff"; icono = "üîº"; }
      //       else if (tendencia === "Decreciente%") { colorTendencia = "#d9534f"; icono = "üîΩ"; }
      //       else if (tendencia === "Estable%") { colorTendencia = "#555"; icono = "‚ûñ"; }

      //       const textoTendencia = tendencia.charAt(0).toUpperCase() + tendencia.slice(1);
      //       m4.innerHTML = `<div class="label">Tendencia</div>
      //                     <div class="value" style="color:${colorTendencia}; font-weight:600; display:flex; align-items:center; gap:6px;">
      //                         <span>${icono}</span>
      //                         <span>${textoTendencia}</span>
      //                     </div>`;

      //       metrics.appendChild(m1);
      //       metrics.appendChild(m2);
      //       metrics.appendChild(m3);
      //       metrics.appendChild(m4);
      //       content.appendChild(metrics);


      const metrics = document.createElement('div');
      metrics.className = 'metrics';

      const m1 = document.createElement('div');
      m1.className = 'metric';
      m1.innerHTML = `<div class="label">Destinos totales</div><div class="value"> ${cantSectores}</div>`;

      const m2 = document.createElement('div');
      m2.className = 'metric';
      m2.innerHTML = `<div class="label">Dest.c/Indicadores</div><div class="value">${cantDestinos}</div>`;


      const m3 = document.createElement('div');
      m3.className = 'metric';
      m3.innerHTML = `<div class="label">Total Indicadores</div><div class="value">${cantActivos}</div>`;

      const m4 = document.createElement('div');
      m4.className = 'metric';
      m4.innerHTML = `<div class="label">Total Mediciones</div><div class="value">${cantMediciones}</div>`;

      const m5 = document.createElement('div');
      m5.className = 'metric';
      m5.innerHTML = `<div class="label">Total Mediciones</div><div class="value">${cantMediciones}</div>`;

      metrics.appendChild(m1);
      metrics.appendChild(m2);
      metrics.appendChild(m3);
      metrics.appendChild(m4);
      metrics.appendChild(m5);
      content.appendChild(metrics);










      documento.appendChild(page);
    }


    function svgToPng(svgElement, width = 300, height = 300) {
      return new Promise(resolve => {
        const svgData = new XMLSerializer().serializeToString(svgElement);
        const svgBlob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);

        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement("canvas");
          canvas.width = width;
          canvas.height = height;

          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, width, height);

          URL.revokeObjectURL(url);
          resolve(canvas.toDataURL("image/png"));
        };

        img.src = url;
      });
    }



    function buildIndicadoresGlobales() {
      const { page, content } = createPage();

      // --- T√çTULO DE SECCI√ìN ---
      const h = document.createElement('h2');
      h.className = 'section-title';
      h.textContent = 'Indicadores Globales';
      content.appendChild(h);

      // --- TABLA DE EJEMPLO ---
      // const table = document.createElement('table');
      // table.innerHTML = `
      //     <thead>
      //       <tr>
      //         <th>Indicador</th><th>Meta</th><th>Valor</th><th>Estado</th>
      //       </tr>
      //     </thead>
      //     <tbody>
      //       <tr><td>Ventas mensuales</td><td>100k</td><td>92k</td><td>AMARILLO</td></tr>
      //       <tr><td>Tasa de conversi√≥n</td><td>2.5%</td><td>3.1%</td><td>VERDE</td></tr>
      //     </tbody>
      //   `;
      // content.appendChild(table);


      const valGlobales = localStorage.getItem('resumenGlobal');
      const resumenGlobal = JSON.parse(valGlobales);

      const metrics = document.createElement('div');
      metrics.className = 'metrics';

      const m1 = document.createElement('div');
      m1.className = 'metric';
      m1.innerHTML = `<div class="label">Promedio Anual</div><div class="value">${resumenGlobal.promAnual}</div>`;

      const m2 = document.createElement('div');
      m2.className = 'metric';
      m2.innerHTML = `<div class="label">Promedio Hist√≥rico</div><div class="value">${resumenGlobal.promHistorico}</div>`;

      const m3 = document.createElement('div');
      m3.className = 'metric';
      let valor = Number(resumenGlobal.variacion) || 0;
      let color = "black";
      let textoValor = "";
      if (valor > 0) { textoValor = `+${valor}`; color = "blue"; }
      else if (valor < 0) { textoValor = `${valor}`; color = "red"; }
      else { textoValor = "0"; color = "gray"; }

      m3.innerHTML = `<div class="label">Œî vs mes anterior</div>
                     <div class="value" style="color:${color}; font-weight:600;">
                        ${textoValor}
                     </div>`;

      const m4 = document.createElement('div');
      m4.className = 'metric';
      let tendencia = (resumenGlobal.tendencia || "");
      let colorTendencia = "black";
      let icono = "";
      if (tendencia === "Creciente%") { colorTendencia = "#007bff"; icono = "üîº"; }
      else if (tendencia === "Decreciente%") { colorTendencia = "#d9534f"; icono = "üîΩ"; }
      else if (tendencia === "Estable%") { colorTendencia = "#555"; icono = "‚ûñ"; }

      const textoTendencia = tendencia.charAt(0).toUpperCase() + tendencia.slice(1);
      m4.innerHTML = `<div class="label">Tendencia</div>
                    <div class="value" style="color:${colorTendencia}; font-weight:600; display:flex; align-items:center; gap:6px;">
                        <span>${icono}</span>
                        <span>${textoTendencia}</span>
                    </div>`;

      metrics.appendChild(m1);
      metrics.appendChild(m2);
      metrics.appendChild(m3);
      metrics.appendChild(m4);
      content.appendChild(metrics);

      // -----------------------
      // Gr√°fico estilo premium
      // -----------------------
      const graf = document.createElement('div');
      graf.style.marginTop = '20px';
      graf.style.display = 'flex';
      graf.style.justifyContent = 'center';

      // Recuperamos el PNG generado
      const pngBase64 = localStorage.getItem("ringGlobalPNG");
      if (pngBase64 !== null) {
        console.log("EXISTE en localStorage");
      } else {console.log ('esta vacio')}

      // Valor real del ring (puede venir de resumenGlobal.globalPercent o calculado previamente)
      const valorRing = resumenGlobal.globalPercent || 0;

      if (pngBase64) {
        graf.innerHTML = `
        <div style="
            width:180px;
            height:180px;
            border-radius:50%;
            background:#fff;
            box-shadow:0 4px 12px rgba(0,0,0,0.1);
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            position:relative;
        ">
            <img src="${pngBase64}" style="width:140px; height:140px; border-radius:50%;">
            <div style="
                position:absolute;
                font-size:1.5em;
                font-weight:700;
                color:#007bff;
            ">

            </div>
        </div>
    `;
      } else {
        graf.innerHTML = `
        <div style="height:180px; width:180px; border:1px dashed #ddd; border-radius:50%;
                    display:flex; align-items:center; justify-content:center; color:#999;
                    box-shadow:0 4px 12px rgba(0,0,0,0.05);">
            [Gr√°fico no disponible]
        </div>
    `;
      }

      content.appendChild(graf);


      // --- RECUPERAR GR√ÅFICO ---
      const imagenGrafico = localStorage.getItem("graficoCumplimientoGlobal");

      // --- CARD CONTENEDOR ELEGANTE ---
      const card = document.createElement("div");
      card.style.marginTop = "25px";
      card.style.padding = "20px";
      card.style.border = "1px solid #e0e0e0";
      card.style.borderRadius = "10px";
      card.style.boxShadow = "0 2px 8px rgba(0,0,0,0.05)";
      card.style.background = "#fff";

      // --- T√çTULO DEL GR√ÅFICO ---
      const tituloGraf = document.createElement("h3");
      tituloGraf.textContent = "Evoluci√≥n del Cumplimiento Global";
      tituloGraf.style.fontSize = "18px";
      tituloGraf.style.marginBottom = "15px";
      tituloGraf.style.color = "#333";
      card.appendChild(tituloGraf);

      // --- CONTENEDOR DEL GR√ÅFICO ---
      const graf2 = document.createElement("div");
      graf2.style.display = "flex";
      graf2.style.alignItems = "center";
      graf2.style.justifyContent = "center";
      graf2.style.padding = "10px 0";

      if (imagenGrafico) {
        graf2.innerHTML = `
      <img src="${imagenGrafico}" 
           style="
             width: 520px; 
             max-width: 100%;
             border-radius: 6px;
             border: 1px solid #ddd;
             padding: 6px;
             background: #fafafa;
           ">
    `;
      } else {
        graf2.innerHTML = `
      <div style="
        width: 520px; height: 220px;
        border: 1px dashed #bbb; 
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #777;
        background: #fafafa;
      ">
        [Gr√°fico no disponible]
      </div>
    `;
      }

      card.appendChild(graf2);

      // --- PIE DE GR√ÅFICO ---
      const nota = document.createElement("div");
      nota.style.marginTop = "10px";
      nota.style.fontSize = "12px";
      nota.style.color = "#666";
      nota.style.textAlign = "center";
      nota.innerHTML =
        "Este gr√°fico representa la evoluci√≥n mensual del porcentaje de cumplimiento consolidado en toda la organizaci√≥n.";
      card.appendChild(nota);

      // Insertar card en el contenido
      content.appendChild(card);

      // Agregar p√°gina final al documento
      documento.appendChild(page);
    }



    function buildSectores() {
      ejemplo.sectores.forEach(sec => {
        const { page, content } = createPage();
        const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = `Indicadores - ${sec.nombre}`;
        content.appendChild(h);

        const table = document.createElement('table');
        const rows = sec.indicadores.map(ind => `
          <tr>
            <td>${ind.nombre}</td>
            <td>${ind.meta}</td>
            <td>${ind.valor}</td>
            <td>${ind.estado.toUpperCase()}</td>
          </tr>
        `).join('');
        table.innerHTML = `<thead><tr><th>Indicador</th><th>Meta</th><th>Valor</th><th>Estado</th></tr></thead><tbody>${rows}</tbody>`;
        content.appendChild(table);

        documento.appendChild(page);
      });
    }

    function buildAnexos() {
      const { page, content } = createPage();
      const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = 'Anexos';
      content.appendChild(h);

      const p = document.createElement('p'); p.textContent = 'Listado completo de mediciones y notas metodol√≥gicas.';
      content.appendChild(p);

      documento.appendChild(page);
    }

    // Cuando se arma el documento numeramos las p√°ginas (footer .page-number)
    function numerarPaginas() {
      const pages = [...document.querySelectorAll('.page')];
      pages.forEach((p, idx) => {
        const el = p.querySelector('.page-number');
        if (el) el.textContent = `P√°gina ${idx + 1} de ${pages.length}`;
      });
    }

    // Build completo
    function buildDocument() {
      clearDocument();
      // buildCover();
      buildCover2();
      buildIntrooverview();
      buildTOC();
      buildResumen();
      buildIndicadoresGlobales();
      buildSectores();
      buildAnexos();
      numerarPaginas();
    }

    // Exportar a PDF usando html2pdf
    async function exportPDF() {
      // Clonar el nodo para no afectar la vista
      const node = documento.cloneNode(true);

      // Opciones de html2pdf
      const opt = {
        margin: 0,
        filename: `Informe_myResultIQ_${new Date().toISOString().slice(0, 10)}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: {
          scale: 1.9,
          useCORS: true,
          letterRendering: true
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak: { mode: ['css'] }
      };


      // html2pdf requiere que el nodo est√© en el DOM en algunos navegadores; lo insertamos oculto temporalmente
      const holder = document.createElement('div'); holder.style.position = 'fixed'; holder.style.left = '-9999px'; holder.style.top = '-9999px'; holder.appendChild(node);
      document.body.appendChild(holder);

      node.querySelectorAll('.page').forEach(p => {
        p.style.boxShadow = 'none';
      });

      try {
        await html2pdf().set(opt).from(node).save();
      } catch (e) {
        console.error('Error generando PDF', e);
        alert('Error generando PDF ‚Äî ver consola');
      } finally {
        document.body.removeChild(holder);
      }
    }

    // Abrir vista previa en nueva ventana (serializamos el HTML del documento)
    function previewNewWindow() {
      const w = window.open('about:blank', '_blank');
      const html = `<!doctype html><html><head><meta charset="utf-8"><title>Preview</title>` +
        '<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">' +
        '<style>body{margin:0;padding:0;background:#ddd}.page{margin:12px auto}</style></head><body>' + documento.innerHTML + '</body></html>';
      w.document.open(); w.document.write(html); w.document.close();
    }

    // Eventos
    document.getElementById('btn-build').addEventListener('click', () => { buildDocument(); window.scrollTo(0, 0); });
    document.getElementById('btn-pdf').addEventListener('click', () => { exportPDF(); });
    document.getElementById('btn-preview').addEventListener('click', () => { previewNewWindow(); });

    // Auto-build initial
    buildDocument();
  </script>
</body>

</html>