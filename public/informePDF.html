<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plantilla Informe - myResultIQ</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@300;400;500&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --azul: #1F78FF;
      --gris: #333333;
      --gris-claro: #F2F2F2;
      --espacio: 16px;
      --page-width-mm: 210mm;
      /* A4 */
    }

    /* Reset básico */
    * {
      box-sizing: border-box
    }

    body {
      font-family: 'Roboto', system-ui, sans-serif;
      color: var(--gris);
      margin: 0;
      background: #efefef;
    }

    /* Contenedor que simula el documento */
    .doc-wrap {
      max-width: 900px;
      margin: 24px auto;
      padding: 24px
    }

    .toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px
    }

    button {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer
    }

    /* Estilos de página (cada .page será una hoja A4 cuando se exporte a PDF) */
    .page {
      width: 210mm;
      height: 297mm;
      /* Fijar exactamente una A4 */
      background: white;
      margin: 0;
      position: relative;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      /* evita cortes extra */
    }

    /* MARCO INTERNO */
    .marco {
      border: 2px solid #007BFF;
      border-radius: 5mm;
      padding: 12mm;
      margin: 20mm 12mm 20mm 12mm;
      /* margen interno superior / inferior */
      height: calc(297mm - 40mm);
      /* altura real útil */
      box-sizing: border-box;
    }

    /* Contenido */
    .content {
      overflow: hidden;
      /* evita “spill” */
    }

    .marco,
    .content,
    table,
    h2,
    p {
      page-break-inside: avoid;
    }

    /* Header / Footer */
    .header {
      position: absolute;
      top: 5mm;
      left: 10mm;
      right: 10mm;
      text-align: center;
    }

    .footer {
      position: absolute;
      bottom: 5mm;
      left: 10mm;
      right: 10mm;
      text-align: center;
    }

    /* === PORTADA PREMIUM === */
    .cover-page {
      padding: 0 !important;
      position: relative;
      overflow: hidden;
      background-size: cover !important;
      background-position: center !important;
      background-repeat: no-repeat !important;
      color: white;
      font-family: 'Montserrat', sans-serif;
    }

    /* Overlay degradado premium */
    .cover-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg,
          rgba(0, 0, 0, 0.65) 0%,
          rgba(0, 0, 0, 0.30) 40%,
          rgba(0, 0, 0, 0.55) 100%);
      z-index: 1;
    }

    /* Contenedor central */
    .cover-content {
      position: absolute;
      inset: 0;
      z-index: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40mm 25mm 30mm 25mm;
      text-align: center;
    }

    /* Logo */
    .cover-logocomun {
      width: 25mm;
      opacity: 0.95;
      margin-bottom: 20mm;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .cover-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30mm;
      /* si querés ajustarlo */
      opacity: 0.95;
    }

    /* Títulos */
    .cover-title {
      font-size: 34pt;
      font-weight: 700;
      margin-bottom: 10mm;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.55);
    }

    .cover-subtitle {
      font-size: 20pt;
      font-weight: 500;
      margin-bottom: 3mm;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.45);
    }

    /* RESUMEN EJECUTIVO */
    .cover-resumen {
      margin-top: 18mm;
      font-size: 14pt;
      font-weight: 300;
      line-height: 1.55;
      text-align: justify;
      padding: 0 5mm;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    }

    /* Pie */
    .cover-bottom {
      position: absolute;
      bottom: 12mm;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 12pt;
      opacity: 0.85;
      z-index: 3;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.55);
    }



    .cover2-page {
      padding: 0 !important;
      position: relative;
      overflow: hidden;
      background-size: cover !important;
      background-position: center !important;
      background-repeat: no-repeat !important;
      color: rgb(65, 138, 247);
      font-family: 'Montserrat', sans-serif;
    }

    /* Overlay degradado premium */
    .cover2-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg,
          rgba(0, 0, 0, 0.65) 0%,
          rgba(0, 0, 0, 0.30) 40%,
          rgba(0, 0, 0, 0.55) 100%);
      z-index: 1;
    }

    /* Contenedor central */
    .cover2-content {
      position: absolute;
      inset: 0;
      z-index: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40mm 25mm 30mm 25mm;
      text-align: center;
    }

    /* Logo */
    .cover2-logocomun {
      width: 25mm;
      opacity: 0.95;
      margin-bottom: 20mm;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .cover2-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30mm;
      /* si querés ajustarlo */
      opacity: 0.95;
    }

    /* Títulos */
    .cover2-title {
      font-size: 30pt;
      font-weight: 500;
      position: absolute;
      top: 95mm;
      /* distancia desde arriba */
      left: 0;
      right: 0;
      text-align: center;
    }

    .cover2-subtitle1 {
      font-size: 20pt;
      font-weight: 500;
      position: absolute;
      top: 70mm;
      left: 0;
      right: 0;
      text-align: center;
    }

    .cover2-subtitle2 {
      font-size: 14pt;
      font-weight: 400;
      position: absolute;
      top: 90mm;
      left: 40mm;
      right: 40mm;
      text-align: justify;
    }

    .cover2-piemyResult {
      font-size: 12pt;
      font-weight: 400;
      position: absolute;
      top: 220mm;
      left: 30mm;
      right: 30mm;
      text-align: justify;
    }

    /* RESUMEN EJECUTIVO */
    .cover2-resumen {
      margin-top: 18mm;
      font-size: 14pt;
      font-weight: 300;
      line-height: 1.55;
      text-align: justify;
      padding: 0 5mm;
      position: absolute;
      top: 170mm;
      /* text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); */
    }

    /* Pie */
    .cover2-bottom {
      position: absolute;
      bottom: 12mm;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 12pt;
      opacity: 0.85;
      z-index: 3;
      /* text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.55); */
    }

    .cover2-piemyResult {
      font-size: 12pt;
      margin-top: 10mm;
      text-align: center;
    }

    .logo-image {
      width: 20mm;
      margin-top: 5mm;
      opacity: 0.9;
    }

    h2.section-title {
      font-family: 'Montserrat';
      font-size: 18px;
      margin: 6px 0 12px 0;
      color: var(--azul)
    }

    /* Tarjetas de métricas */
    .metrics {
      display: flex;
      gap: 12px;
      flex-wrap: wrap
    }

    .metric {
      flex: 1 1 180px;
      background: #fff;
      border: 1px solid #eee;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03)
    }

    .metric .label {
      font-size: 12px;
      color: #666
    }

    .metric .value {
      font-size: 22px;
      font-weight: 600;
      margin-top: 6px
    }

    /* Tabla simple */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #eee;
      text-align: left;
      font-size: 13px
    }

    th {
      background: var(--gris-claro);
      font-weight: 600
    }

    /* Page break helper */
    .page-break {
      page-break-after: always;
    }

    /* TOC */
    .toc-list {
      list-style: none;
      padding: 0;
      margin: 0
    }

    .toc-list li {
      padding: 6px 0;
      border-bottom: 1px dashed #eee
    }

    .separator {
      width: 65%;
      height: 3px;
      background: #444;
      border-radius: 3px;
      margin: 0 auto 35px auto;
    }

    /* Responsive preview scaling */
    @media (max-width:980px) {
      .doc-wrap {
        padding: 10px
      }

      .page {
        width: 100%;
        min-height: 1200px
      }
    }
  </style>
</head>

<body>

  <div class="doc-wrap">
    <div class="toolbar">
      <button id="btn-build">Generar documento</button>
      <button id="btn-pdf">Exportar a PDF</button>
      <button id="btn-preview">Vista previa en nueva ventana</button>
      <label style="margin-left:12px;font-size:13px;color:#555">Plantilla base</label>
    </div>

    <!-- Contenedor donde el script creará las páginas -->
    <div id="documento"></div>
  </div>

  <!-- Dependencia para exportar a PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <script>
    // Datos de ejemplo (luego los reemplazás por tus datos reales)
    empresa = "SEDRONAR";
    const ejemplo = {
      titulo: 'Informe de Indicadores',
      subtitulo: 'Gestión, seguimiento y análisis de métricas organizacionales',
      fecha: new Date().toLocaleDateString('es-AR', { year: 'numeric', month: 'long', day: 'numeric' }),
      autor: 'Área de Gestión de Indicadores',
      resumen: {
        cumplimientoGlobal: '82%',
        promedioHistorico: '78.4',
        deltaMes: '+3.2%'
      },
      sectores: [
        {
          id: 1, nombre: 'Comercial', indicadores: [
            { id: 11, nombre: 'Ventas mensuales', meta: '100k', valor: '92k', estado: 'amarillo' },
            { id: 12, nombre: 'Tasa de conversión', meta: '2.5%', valor: '3.1%', estado: 'verde' }
          ]
        },
        {
          id: 2, nombre: 'Operaciones', indicadores: [
            { id: 21, nombre: 'Tiempo de respuesta', meta: '<24h', valor: '18h', estado: 'verde' },
            { id: 22, nombre: 'Incidentes críticos', meta: '0', valor: '1', estado: 'rojo' }
          ]
        }
      ]
    };

    // --- Construcción del documento (DOM) ---
    const documento = document.getElementById('documento');

    function clearDocument() { documento.innerHTML = ''; }

    function createPage() {
      const page = document.createElement('section');
      page.className = 'page';

      // Header (fuera del marco)
      const header = document.createElement('div');
      header.className = 'header';
      header.innerHTML = `<div>${ejemplo.titulo}</div><div>${ejemplo.fecha}</div>`;
      page.appendChild(header);

      // Marco interno
      const marco = document.createElement('div');
      marco.className = 'marco';
      page.appendChild(marco);

      // Contenido dentro del marco
      const content = document.createElement('div');
      content.className = 'content';
      marco.appendChild(content);

      // Footer (fuera del marco)
      const footer = document.createElement('div');
      footer.className = 'footer';
      footer.innerHTML = `
    <div>Generado por: ${ejemplo.autor}</div>
    <div class="page-number">Página</div>
  `;
      page.appendChild(footer);

      return { page, content };
    }

    function buildCover() {
      const page = document.createElement('section');
      page.className = 'page cover-page';

      // === Fondo de barras diagonales modernas ===
      page.style.background = `
      repeating-linear-gradient(
        -45deg,
        #0a2850 0,
        #0a2850 12mm,
        #123d80 12mm,
        #123d80 24mm
      )
  `;
      page.style.backgroundSize = "cover";

      // Overlay premium
      const overlay = document.createElement('div');
      overlay.className = 'cover-overlay';
      page.appendChild(overlay);

      // Contenido central
      const content = document.createElement('div');
      content.className = 'cover-content';

      // Logo
      const logo = document.createElement('img');
      logo.className = 'cover-logo';
      logo.src = "../dist/images/leon.png";
      // content.appendChild(logo);
      page.appendChild(logo);  // ⬅️ importante: no va dentro de cover-content

      // Título principal
      const title = document.createElement('div');
      title.className = 'cover-title';
      title.textContent = ejemplo.titulo;
      content.appendChild(title);

      // Subtítulo
      const subtitle = document.createElement('div');
      subtitle.className = 'cover-subtitle';
      subtitle.textContent = ejemplo.subtitulo;
      content.appendChild(subtitle);

      // Resumen ejecutivo
      const resumen = document.createElement('div');
      resumen.className = 'cover-resumen';
      resumen.textContent =
        "Este informe resume los principales indicadores estratégicos, " +
        "identifica variaciones críticas y presenta una visión analítica " +
        "general del desempeño institucional durante el período evaluado. <br>" +
        "<br><br>" +
        "Los datos presentados han sido procesados con la plataforma <strong>myResultIQ</strong>, asegurando precisión y trazabilidad en cada etapa del análisis.";
      content.appendChild(resumen);

      page.appendChild(content);

      // Pie inferior
      const bottom = document.createElement('div');
      bottom.className = 'cover-bottom';
      bottom.textContent = `Generado el ${ejemplo.fecha}`;
      page.appendChild(bottom);

      documento.appendChild(page);
    }

    function buildCover2() {
      const page = document.createElement('section');
      page.className = 'page cover2-page';

      // === Fondo completo ===
      // page.style.backgroundImage = 'url("../dist/images/Fondomy.png")';
      page.style.backgroundImage = 'url("../dist/images/PortadaAzulBlanca.png")';

      // Contenedor central
      const content = document.createElement('div');
      content.className = 'cover2-content';

      // // Logo
      // const logo = document.createElement('img');
      // logo.className = 'cover2-logo';
      // logo.src = "../dist/images/leon.png";
      // content.appendChild(logo);

            // Subtítulo
      const subtitle = document.createElement('div');
      subtitle.className = 'cover2-subtitle1';
      subtitle.textContent = "Informe Ejecutivo";
      content.appendChild(subtitle);

      // Separador

      const separator = document.createElement('div');
      separator.className = 'separator';
      content.appendChild(separator);

      // Título
      const title = document.createElement('div');
      title.className = 'cover2-title';
      title.textContent = "Indicadores de Gestión"
      content.appendChild(title);

      // Separador
      const separator2 = document.createElement('div');
      separator2.className = 'separator';
      content.appendChild(separator2);


      // Pie inferior
      const bottom = document.createElement('div');
      bottom.className = 'cover2-bottom';
      bottom.textContent = `· Generado: ${ejemplo.fecha}`;
      content.appendChild(bottom);

      page.appendChild(content);

      documento.appendChild(page);
    }

    function buildTOC() {
      const { page, content } = createPage();
      const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = 'Índice';
      content.appendChild(h);

      const ul = document.createElement('ul'); ul.className = 'toc-list';
      // Generamos entradas acordes a las secciones previstas
      const entradas = ['Resumen Ejecutivo', 'Indicadores Globales', 'Indicadores por Sector', 'Análisis de Cumplimientos', 'Anexos'];
      entradas.forEach((e, i) => {
        const li = document.createElement('li'); li.textContent = `${i + 1}. ${e}`;
        ul.appendChild(li);
      });

      content.appendChild(ul);

      const subtitle2 = document.createElement('div');
      subtitle2.className = 'cover2-subtitle2';
      subtitle2.innerHTML =
        "Gestión, seguimiento y análisis de métricas organizacionales.<br><br>El presente documento tiene como finalidad proporcionar una visión integral y consolidada del desempeño organizacional a través del análisis de los indicadores clave de gestión (KPIs).<br><br> Este informe ejecutivo sintetiza la información del dashboard interactivo en un formato estructurado, facilitando la toma de decisiones estratégicas basadas en datos cuantitativos y cualitativos del período analizado.<br><br>Este informe resume los principales indicadores estratégicos, identifica variaciones críticas y presenta una visión analítica general del desempeño institucional durante el período evaluado. ";
      content.appendChild(subtitle2);


      const piemyResult = document.createElement('div');
      piemyResult.className = 'cover2-piemyResult';
      piemyResult.innerHTML = `
          Los datos de este informe han sido procesados con la plataforma <strong>myResultIQ</strong>,
          asegurando precisión y trazabilidad en cada etapa del análisis.
          <br><br>
          <img src="/dist/images/leon.png" class="logo-image" alt="Logo">
        `;
      content.appendChild(piemyResult);

      // Separador
      const separator = document.createElement('div');
      separator.className = 'separator';
      content.appendChild(separator);

      // === RESUMEN EJECUTIVO ===
      const resumen = document.createElement('div');
      resumen.className = 'cover2-resumen';
      resumen.innerHTML = `
        <strong>1.1 Objetivos:</strong><br>
        • Evaluar el cumplimiento de los KPIs<br>
        • Analizar tendencias mensuales y anuales<br>
        • Identificar áreas de mejora operativa<br><br>
      `;
      content.appendChild(resumen);

      documento.appendChild(page);
    }

    function buildResumen() {
      const { page, content } = createPage();
      const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = 'Resumen Ejecutivo';
      content.appendChild(h);

      const metrics = document.createElement('div'); metrics.className = 'metrics';
      const m1 = document.createElement('div'); m1.className = 'metric'; m1.innerHTML = `<div class="label">Cumplimiento global</div><div class="value">${ejemplo.resumen.cumplimientoGlobal}</div>`;
      const m2 = document.createElement('div'); m2.className = 'metric'; m2.innerHTML = `<div class="label">Promedio histórico</div><div class="value">${ejemplo.resumen.promedioHistorico}</div>`;
      const m3 = document.createElement('div'); m3.className = 'metric'; m3.innerHTML = `<div class="label">Δ vs mes anterior</div><div class="value">${ejemplo.resumen.deltaMes}</div>`;
      metrics.appendChild(m1); metrics.appendChild(m2); metrics.appendChild(m3);
      content.appendChild(metrics);

      // ejemplo de grafico simple (placeholder)
      const graf = document.createElement('div'); graf.style.marginTop = '12px'; graf.innerHTML = '<div style="height:140px;border:1px dashed #ddd;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#999">[Gráfico aquí]</div>';
      content.appendChild(graf);

      documento.appendChild(page);
    }

    function buildIndicadoresGlobales() {
      const { page, content } = createPage();
      const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = 'Indicadores Globales';
      content.appendChild(h);

      // tabla de ejemplo
      const table = document.createElement('table');
      table.innerHTML = `
        <thead><tr><th>Indicador</th><th>Meta</th><th>Valor</th><th>Estado</th></tr></thead>
        <tbody>
          <tr><td>Ventas mensuales</td><td>100k</td><td>92k</td><td>AMARILLO</td></tr>
          <tr><td>Tasa de conversión</td><td>2.5%</td><td>3.1%</td><td>VERDE</td></tr>
        </tbody>
      `;
      content.appendChild(table);
      documento.appendChild(page);
    }

    function buildSectores() {
      ejemplo.sectores.forEach(sec => {
        const { page, content } = createPage();
        const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = `Indicadores - ${sec.nombre}`;
        content.appendChild(h);

        const table = document.createElement('table');
        const rows = sec.indicadores.map(ind => `
          <tr>
            <td>${ind.nombre}</td>
            <td>${ind.meta}</td>
            <td>${ind.valor}</td>
            <td>${ind.estado.toUpperCase()}</td>
          </tr>
        `).join('');
        table.innerHTML = `<thead><tr><th>Indicador</th><th>Meta</th><th>Valor</th><th>Estado</th></tr></thead><tbody>${rows}</tbody>`;
        content.appendChild(table);

        documento.appendChild(page);
      });
    }

    function buildAnexos() {
      const { page, content } = createPage();
      const h = document.createElement('h2'); h.className = 'section-title'; h.textContent = 'Anexos';
      content.appendChild(h);

      const p = document.createElement('p'); p.textContent = 'Listado completo de mediciones y notas metodológicas.';
      content.appendChild(p);

      documento.appendChild(page);
    }

    // Cuando se arma el documento numeramos las páginas (footer .page-number)
    function numerarPaginas() {
      const pages = [...document.querySelectorAll('.page')];
      pages.forEach((p, idx) => {
        const el = p.querySelector('.page-number');
        if (el) el.textContent = `Página ${idx + 1} de ${pages.length}`;
      });
    }

    // Build completo
    function buildDocument() {
      clearDocument();
      buildCover();
      buildCover2();
      buildTOC();
      buildResumen();
      buildIndicadoresGlobales();
      buildSectores();
      buildAnexos();
      numerarPaginas();
    }

    // Exportar a PDF usando html2pdf
    async function exportPDF() {
      // Clonar el nodo para no afectar la vista
      const node = documento.cloneNode(true);

      // Opciones de html2pdf
      const opt = {
        margin: 0,
        filename: `Informe_myResultIQ_${new Date().toISOString().slice(0, 10)}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: {
          scale: 1.9,
          useCORS: true,
          letterRendering: true
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak: { mode: ['css'] }
      };


      // html2pdf requiere que el nodo esté en el DOM en algunos navegadores; lo insertamos oculto temporalmente
      const holder = document.createElement('div'); holder.style.position = 'fixed'; holder.style.left = '-9999px'; holder.style.top = '-9999px'; holder.appendChild(node);
      document.body.appendChild(holder);

      node.querySelectorAll('.page').forEach(p => {
        p.style.boxShadow = 'none';
      });

      try {
        await html2pdf().set(opt).from(node).save();
      } catch (e) {
        console.error('Error generando PDF', e);
        alert('Error generando PDF — ver consola');
      } finally {
        document.body.removeChild(holder);
      }
    }

    // Abrir vista previa en nueva ventana (serializamos el HTML del documento)
    function previewNewWindow() {
      const w = window.open('about:blank', '_blank');
      const html = `<!doctype html><html><head><meta charset="utf-8"><title>Preview</title>` +
        '<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">' +
        '<style>body{margin:0;padding:0;background:#ddd}.page{margin:12px auto}</style></head><body>' + documento.innerHTML + '</body></html>';
      w.document.open(); w.document.write(html); w.document.close();
    }

    // Eventos
    document.getElementById('btn-build').addEventListener('click', () => { buildDocument(); window.scrollTo(0, 0); });
    document.getElementById('btn-pdf').addEventListener('click', () => { exportPDF(); });
    document.getElementById('btn-preview').addEventListener('click', () => { previewNewWindow(); });

    // Auto-build initial
    buildDocument();
  </script>
</body>

</html>