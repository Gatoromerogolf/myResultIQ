<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Dashboard - Administrador</title>

</head>

<div class="container mt-4">
  <h4>Cumplimiento por sector</h4>
  <div id="chartCumplimiento"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
  var options = {
    chart: {
      type: 'bar',
      height: 350
    },
    title: {
      text: 'Indicadores de cumplimiento (%)',
      align: 'center'
    },
    series: [{
      name: 'Cumplimiento',
      data: [95, 82, 60, 74, 88] // valores de cumplimiento en %
    }],
    xaxis: {
      categories: ['Compras', 'Ventas', 'RRHH', 'LogÃ­stica', 'IT'] // sectores
    },
    yaxis: {
      max: 100,
      labels: {
        formatter: val => val + "%"
      }
    },
    colors: ['#4e73df'], // color de las barras
    dataLabels: {
      enabled: true,
      formatter: val => val + "%"
    }
  };

  var chart = new ApexCharts(document.querySelector("#chartCumplimiento"), options);
  chart.render();
</script>


<!--
ðŸ‘‰ Con esto podÃ©s transformar los datos de tu BD en un grÃ¡fico visual.
Si tus indicadores ya estÃ¡n en Express (por ejemplo en una consulta SQL), se puede armar un endpoint que devuelva JSON con los valores y cargar el grÃ¡fico dinÃ¡micamente con fetch().

Â¿QuerÃ©s que te prepare la versiÃ³n que se conecta al backend (Express â†’ consulta SQL â†’ JSON â†’ ApexCharts)?

ðŸ”¹ 1. Backend en Express

Supongamos que en tu BD tenÃ©s una tabla sectores y otra indicadores, y ya calculÃ¡s el % de cumplimiento por sector.
Creamos un endpoint que devuelva esos datos en JSON:

// Ejemplo en Express con MySQL
app.get('/api/cumplimiento-sectores', async (req, res) => {
  try {
    // Esta consulta es ilustrativa. Adaptala a tu modelo real.
    const [rows] = await pool.query(`
      SELECT s.nombre AS sector, 
             ROUND(AVG(i.cumplimiento), 0) AS porcentaje
      FROM sectores s
      JOIN indicadores i ON i.sector_id = s.id
      GROUP BY s.id
      ORDER BY s.nombre
    `);

    res.json(rows); // [{ sector: "Compras", porcentaje: 95 }, ...]
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Error al obtener datos" });
  }
});


ðŸ‘‰ Esto devuelve algo asÃ­ en /api/cumplimiento-sectores:

[
  { "sector": "Compras", "porcentaje": 95 },
  { "sector": "Ventas", "porcentaje": 82 },
  { "sector": "RRHH", "porcentaje": 60 },
  { "sector": "LogÃ­stica", "porcentaje": 74 },
  { "sector": "IT", "porcentaje": 88 }
]

ðŸ”¹ 2. Frontend con ApexCharts

En tu HTML usÃ¡s fetch() para consumir ese endpoint y armar el grÃ¡fico:

<div class="container mt-4">
  <h4>Cumplimiento por sector</h4>
  <div id="chartCumplimiento"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
  async function cargarGrafico() {
    try {
      const res = await fetch('/api/cumplimiento-sectores');
      const data = await res.json();

      const sectores = data.map(d => d.sector);
      const valores = data.map(d => d.porcentaje);

      var options = {
        chart: {
          type: 'bar',
          height: 350
        },
        title: {
          text: 'Indicadores de cumplimiento (%)',
          align: 'center'
        },
        series: [{
          name: 'Cumplimiento',
          data: valores
        }],
        xaxis: {
          categories: sectores
        },
        yaxis: {
          max: 100,
          labels: {
            formatter: val => val + "%"
          }
        },
        colors: ['#28a745'], // verde
        dataLabels: {
          enabled: true,
          formatter: val => val + "%"
        }
      };

      var chart = new ApexCharts(document.querySelector("#chartCumplimiento"), options);
      chart.render();

    } catch (err) {
      console.error("Error cargando grÃ¡fico:", err);
    }
  }

  cargarGrafico();
</script>

ðŸ”¹ 3. Flujo final

El frontend pide datos a /api/cumplimiento-sectores.

El backend consulta la BD y devuelve JSON.

ApexCharts renderiza el grÃ¡fico dinÃ¡micamente.

ðŸ‘‰ Â¿QuerÃ©s que te prepare tambiÃ©n el SQL exacto para crear esa columna de â€œcumplimientoâ€ en tu tabla de indicadores (para que despuÃ©s sea mÃ¡s fÃ¡cil calcular los promedios por sector)?



Perfecto ðŸ‘.
Te muestro cÃ³mo podrÃ­as tener la estructura en SQL para manejar un campo de cumplimiento (%) en tus indicadores y despuÃ©s calcular fÃ¡cilmente los promedios por sector.

ðŸ”¹ 1. Tabla sectores
CREATE TABLE sectores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

ðŸ”¹ 2. Tabla indicadores

Le agregamos un campo cumplimiento en porcentaje (0 a 100).

CREATE TABLE indicadores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    sector_id INT NOT NULL,
    nombre VARCHAR(150) NOT NULL,
    cumplimiento DECIMAL(5,2) DEFAULT 0, -- % de cumplimiento
    FOREIGN KEY (sector_id) REFERENCES sectores(id)
);


ðŸ‘‰ El campo cumplimiento lo podÃ©s cargar cada vez que se actualiza el indicador.
Ejemplo: si un indicador estÃ¡ al 75% de su meta â†’ cumplimiento = 75.00.

ðŸ”¹ 3. Insertar datos de prueba
INSERT INTO sectores (nombre) VALUES
('Compras'), ('Ventas'), ('RRHH'), ('LogÃ­stica'), ('IT');

INSERT INTO indicadores (sector_id, nombre, cumplimiento) VALUES
(1, 'Tiempo de ciclo de compra', 95),
(1, 'Cumplimiento proveedores', 90),
(2, 'Objetivos de ventas', 80),
(2, 'RetenciÃ³n de clientes', 84),
(3, 'CapacitaciÃ³n anual', 60),
(4, 'Entregas a tiempo', 70),
(4, 'Stock disponible', 78),
(5, 'Disponibilidad sistemas', 88);

ðŸ”¹ 4. Consulta de % de cumplimiento por sector

La query que despuÃ©s usa tu backend serÃ­a:

SELECT s.nombre AS sector,
       ROUND(AVG(i.cumplimiento), 0) AS porcentaje
FROM sectores s
JOIN indicadores i ON i.sector_id = s.id
GROUP BY s.id
ORDER BY s.nombre;


ðŸ“Œ Resultado esperado con los datos de ejemplo:

sector	porcentaje
Compras	93
IT	88
LogÃ­stica	74
RRHH	60
Ventas	82

De esa forma tenÃ©s todo listo para que el endpoint /api/cumplimiento-sectores en Express te devuelva exactamente el JSON que alimenta ApexCharts.

ðŸ‘‰ Â¿QuerÃ©s que ademÃ¡s te prepare la migraciÃ³n SQL para agregar el campo cumplimiento si ya tenÃ©s la tabla indicadores creada (sin tener que borrarla)?

-->