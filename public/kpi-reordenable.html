<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Dashboard - Administrador</title>

</head>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-4">
    <h4>Usuarios</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Legajo</th>
                <th>Apellido</th>
                <th>Nombres</th>
            </tr>
        </thead>
        <tbody id="tablaUsuarios">
            <!-- Estos datos normalmente vienen de tu backend -->
            <tr data-id="100">
                <td>100</td>
                <td>Pérez</td>
                <td>Juan</td>
            </tr>
            <tr data-id="101">
                <td>101</td>
                <td>García</td>
                <td>Ana</td>
            </tr>
            <tr data-id="102">
                <td>102</td>
                <td>López</td>
                <td>Pedro</td>
            </tr>
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
    // Inicializar SortableJS sobre el tbody
    new Sortable(document.getElementById('tablaUsuarios'), {
        animation: 150,
        onEnd: function () {
            // Armar array con IDs de los usuarios en el nuevo orden
            const filas = [...document.querySelectorAll("#tablaUsuarios tr")];
            const orden = filas.map(f => f.dataset.id);

            console.log("Nuevo orden:", orden);

            // Enviar al backend con fetch
            fetch('/usuarios/ordenar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ orden })
            })
                .then(res => res.json())
                .then(data => console.log("Guardado:", data))
                .catch(err => console.error(err));
        }
    });



    // Recibir el orden de usuarios
    app.post('/usuarios/ordenar', (req, res) => {
        const { orden } = req.body;
        // `orden` es un array de IDs en el nuevo orden
        console.log("Orden recibido:", orden);

        // Ejemplo: actualizar la columna "orden" en la tabla `usuarios`
        // Suponiendo que usás MySQL con knex o pool.query
        orden.forEach((id, index) => {
            pool.query('UPDATE usuarios SET orden = ? WHERE id = ?', [index + 1, id]);
        });

        res.json({ ok: true, nuevoOrden: orden });
    });

</script>